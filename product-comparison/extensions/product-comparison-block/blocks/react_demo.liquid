{% render 'regions' %}

<script>
  const allProducts = {{ block.settings.collection.products | json }}
  window.allProducts = allProducts;
  console.log({allProducts});
  console.log('React Demo loaded', window.allProducts);
</script>

<script id="product-metafields" type="application/json">
  {
  "allProducts": {{ block.settings.collection.products | json }},
  "allMetafieldValues": {{ block.settings.collection.products | map: "metafields" | map: "product_specs" | json }},
  "tableVariant": {{ block.settings.table_variant | json }},
  "currentProduct": {{ product |  json }},
  "collection": {{ block.settings.collection | json }}
  }
</script>

<script defer="defer">
  const productData = JSON.parse(document.getElementById('product-metafields').innerText)
  const productMetafieldData = []
  for (let i=0; i < productData?.allProducts.length; i++) {
    const product = productData.allProducts[i]
    const metafield = productData.allMetafieldValues[i]
    productMetafieldData.push({ ...product, specs: metafield })
  }
  console.log(productMetafieldData)
  window.productMetafieldData = productMetafieldData
  window.tableVariant = productData.tableVariant
  window.currentProduct = productData.currentProduct
  window.collection = productData.collection
</script>

<div id="container" data-theme="light"></div>

{% schema %}
{
  "name": "React Product Comparison",
  "target": "section",
  "javascript": "index.js",
  "stylesheet": "index.css",
  "settings": [
    {
      "type": "product",
      "id": "current_product",
      "label": "product",
      "autofill": true
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "select",
      "id": "table_variant",
      "label": "Table Variant",
      "options": [
        {
          "value": "multi-column",
          "label": "Multi-Column Table"
        },
        {
          "value": "two-column",
          "label": "Two-Column Table"
        }
      ],
      "default": "multi-column"
    }
  ]
}
{% endschema %}
